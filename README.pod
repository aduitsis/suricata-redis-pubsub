=head1 Suricata Redis PubSub

A simple set of tools to announce Suricata events into a Redis pubsub channel
and subscribe to those events with an exabgp client program.


=head1 publisher

Publisher.pl binds and listens to a unix socket to which Suricata will connect
and transmit events. Upon receiving each event, the publisher will construct an
appropriate message encoded in JSON and publish it in a Redis pubsub channel.


=head1 subscriber

Subscriber.pl listens on the previously mentioned Redis channel for
alert messages. Upon receiving each alert, it will write an appropriate exabgp
control message in its standard output, announcing the source IP of the alert to
be routed to an appropriate target (most typically a blackhole). At the same
time, a countdown is initiated for that source and when it reaches zero the
source is withdrawn with an appropriate exabgp message. The incoming messages
can be filtered by signature, source IP prefix or severity. 


=head1 options

At present, documentation is sparse as the options are being worked on. Please
review the two scripts for available cli parameters. 

=head2 publisher

=over

=item B<-d>

Run in debug mode, debug messages are printed in the standard error.

=item B<-r|--redis> I<redis server>

Connect to I<redis server> and publish events. This is required and 
does not have a default value.

=item B<-u|--user> I<userid>

Drop privileges to user I<userid>. Defaults to nobody.

=item B<-s|--sock> I<socket>

Listen for suricata events in UNIX socket I<socket>. Default value is
B</var/run/suricata.sock>. You should configure your suricata to use that
socket. Here is a very simple example fragment:

  - eve-log:
    enabled: yes
      filetype: unix_stream
      filename: /var/run/suricata.sock
      types:
        - alert:


=item B<-c|--channel> I<channel_name>

Publish events in Redis channel named I<channel_name>. The event schema is in
flux currently. However, it is guaranteed that the subscriber and the publisher
code will move in lockstep across changes in this repo.

=item B<--logstash>

Also publish in channel logstash-I<channel_name> (see -c option above). This is
assumed to be a channel where a logstash instance has subscribed. The JSON posted
in this channel is flat. Nested objects are not forbidden in elasticsearch and
logstash, but may present some difficulties. See L<https://github.com/elastic/kibana/pull/5411>
and L<https://github.com/elastic/kibana/issues/1084>.

=back 

=head1 examples

=head2 publisher

 publisher.pl -r redis_server -u nobody -s suricata.sock
  --channel suricata --logstash

=head2 subscriber
 
 subscriber.pl --redis_host redis_server --exclude-sig=2013357
  --exclude-source=10.10.0.0/16 --severity-thres=2 

=head1 author

Athanasios Douitsis, L<aduitsis@cpan.org> 

=head1 bugs / suggestions

Please file a bug in github, many thanks in advance.


=head1 dependencies

Please install these modules in order for this software to work:

=over

=item *
AnyEvent

=item *
AnyEvent::Redis

=item *
JSON

=item * 
Data::Printer

=item *
Sub::Install (for the IPv6::Address to work)

=back 

The IPv6::Address is a separate Perl module, writen also by me (see
L<https://github.com/aduitsis/IPv6-Address>, but I have included a local copy
inside this package to make things easier. It might become required to install
that module in the future.


=head1 license

Copyright (c) 2016 Athanasios Douitsis. All rights reserved.
This program is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.


=cut
